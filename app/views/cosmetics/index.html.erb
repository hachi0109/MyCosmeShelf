<div class="container">
  <header class="page-header">
    <%= link_to "≪ マイページ", user_root_path, class: "back-link" %>
    <h1 class="page-title">コスメ一覧</h1>
  </header>

  <div class="genre-nav">
    <%= link_to "すべて", cosmetics_path, class: "genre-pill #{'active' unless params[:genre_id].present?}" %>
    <% @genres.each do |genre| %>
      <%= link_to genre.name, cosmetics_path(genre_id: genre.id), class: "genre-pill #{'active' if params[:genre_id].to_i == genre.id}" %>
    <% end %>
  </div>

  <% if params[:genre_id].present? %>
    <% genre = Genre.find(params[:genre_id]) %>
    <div class="filter-banner">
      <span>
        <strong><%= genre.name %></strong>
        <span style="font-size: 0.9em; margin-left: 8px; color: #666;">(在庫合計: <strong><%= @total_stock %></strong>)</span>
      </span>
      <%= link_to "× 解除", cosmetics_path, class: "filter-clear" %>
    </div>
  <% end %>

  <div class="cosmetics-grid">
    <% if @cosmetics.any? %>
      <% @cosmetics.each do |cosmetic| %>
        <%= link_to cosmetic_path(cosmetic), class: "cosmetic-card-link" do %>
        <div class="cosmetic-card <%= 'out-of-stock' if cosmetic.stock.to_i == 0 %>">
          <div class="card-image-wrapper">
            <% if cosmetic.image.attached? %>
              <%= image_tag cosmetic.image.variant(resize_to_limit: [300, 300]), class: "cosme-image" %>
            <% else %>
              <div class="no-image-placeholder">
                <span>No Photo</span>
              </div>
            <% end %>
          </div>
          <div class="card-info">
            <span class="card-genre"><%= cosmetic.genre.name %></span>
            <div class="card-name"><%= cosmetic.name %></div>
            <div class="card-brand"><%= cosmetic.brand %></div>
            <div class="card-meta">
              <span class="stock-badge">在庫: <%= cosmetic.stock %></span>
              <span class="date"><%= cosmetic.created_at.strftime("%Y.%m.%d") %></span>
            </div>
          </div>
        </div>
        <% end %>
      <% end %>
    <% else %>
      <div class="empty-state">
        <p>表示できるコスメがありません。</p>
      </div>
    <% end %>
  </div>

  <%= link_to new_cosmetic_path, class: "fab-btn" do %>
    ＋
  <% end %>
</div>

<style>
  :root {
    --main-color: <%= @theme.name == 'グリーン' ? '#78978b' : 
                      @theme.name == 'ピンク' ? '#d8a3a3' : 
                      @theme.name == 'ブルー' ? '#8ba2ad' : 
                      @theme.name == 'ミルクティー' ? '#bcaaa4' : '#d8a3a3' %>;
    --main-bg: <%= @theme.name == 'グリーン' ? '#f4f7f6' : 
                   @theme.name == 'ピンク' ? '#fdf8f8' : 
                   @theme.name == 'ブルー' ? '#f4f6f7' : 
                   @theme.name == 'ミルクティー' ? '#f7f5f4' : '#fdf8f8' %>;
    --text-color: #5a5a5a;
  }
</style>
